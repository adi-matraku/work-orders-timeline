<div class="panel-overlay"
     escClose
     (esc)="onClose()"
     (click)="onClose()"
     role="presentation"
     @panelAnimation>
  <form
    class="panel-container"
    role="dialog"
    aria-labelledby="panel-title"
    aria-describedby="panel-description"
    (click)="$event.stopPropagation()"
    [formGroup]="workOrderForm"
    (ngSubmit)="submit()">

    <div class="header">
      <div class="title-group">
        <h2 class="main-title" id="panel-title">
          {{ data() ? 'Edit Work Order' : 'Work Order Details' }}
        </h2>
        <p class="sub-title" id="panel-description">Specify the dates, name and status for this order</p>
      </div>
      <div class="actions">
        <button type="button" class="btn-cancel" aria-label="Cancel and close panel" (click)="onClose()">
          <span class="btn-cancel-text">Cancel</span>
        </button>

        <button type="submit" class="btn-submit" [attr.aria-label]="data() ? 'Save work order' : 'Create work order'">
          <span class="btn-submit-text">
            {{ data() ? 'Save' : 'Create' }}
          </span>
        </button>
      </div>
    </div>

    <div class="header-divider"></div>

    <div class="form-content">

      <div class="field-group">
        <label class="input-label">Work Order Name</label>
        <input
          autoFocusElement
          type="text"
          formControlName="name"
          class="input-field"
          placeholder="Enter work order name"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('name')"
        />

        @if (isInvalid('name')) {
          <span class="error-text">Name is required</span>
        }
      </div>

      <div class="field-group">
        <label class="input-label">Status</label>

        <ng-select
          class="status-dropdown custom-dropdown-panel"
          [items]="statuses"
          bindLabel="label"
          bindValue="value"
          formControlName="status"
          [appendTo]="'body'"
          [clearable]="false"
          [searchable]="false"
        >

          <ng-template ng-label-tmp let-item="item">
            <span class="status-badge" [attr.data-status]="item.value">
              {{ item.label }}
            </span>
          </ng-template>

          <ng-template ng-option-tmp let-item="item">
            <span class="status-badge" [attr.data-status]="item.value">
              {{ item.label }}
            </span>
          </ng-template>
        </ng-select>
      </div>

      <div class="field-group">
        <label class="input-label">Start date</label>

        <div class="datepicker-wrapper">
          <input
            class="input-field"
            formControlName="startDate"
            ngbDatepicker
            #startDp="ngbDatepicker"
            placeholder="Select a date"
            aria-haspopup="dialog"
            aria-label="Start date"
            (click)="startDp.open()"
          />
        </div>
        @if (isInvalid('startDate')) {
          <span class="error-text">Start date is required</span>
        }
      </div>

      <div class="field-group">
        <label class="input-label">End date</label>

        <div class="datepicker-wrapper">
          <input
            class="input-field"
            formControlName="endDate"
            ngbDatepicker
            #endDp="ngbDatepicker"
            placeholder="Select a date"
            aria-haspopup="dialog"
            aria-label="End date"
            (click)="endDp.open()"
          />
        </div>
        @if (isInvalid('startDate')) {
          <span class="error-text">Start date is required</span>
        }
      </div>
    </div>
  </form>
</div>
